"undefined"==typeof console&&(this.console={log:function(){}});function _localize(a){var b=$.localization.string.apply(a,arguments);return b?b:"undefined"===typeof b?a:""}var LargeUI=!0,SmallUI=!0;$("html").hasClass("smallTiles")?(LargeUI=!1,SmallUI=!0):(LargeUI=!0,SmallUI=!1);function base64decode(a){return window.atob?atob(a):Base64.decode(a)}function isInsideVPN(){return"object"===typeof CONFIG&&CONFIG.isVPN}
function checkVPNConfig(a){return isInsideVPN()?"object"===typeof CONFIG.EXTERNAL?CONFIG.EXTERNAL[a]:!1:!1}
function getBoomarksDisplay(){if(!CTXS.Gateway.bookmarksKnob.getBookmarkDisplayDone){for(var a=document.getElementById("gatewaycustomStyle").sheet?document.getElementById("gatewaycustomStyle").sheet.rules||document.getElementById("gatewaycustomStyle").sheet.cssRules:document.getElementById("gatewaycustomStyle").styleSheet.rules,b=0;b<a.length;b++)".enterprise_website_section"==a[b].selectorText&&(showEnterpriseBookmarks=!1),".personal_websites_section"==a[b].selectorText&&(showPersonalBookmarks=!1);
CTXS.Gateway.bookmarksKnob.getBookmarkDisplayDone=!0}}function sendProperChoice(a){if(-1!=a.indexOf("agent"))return"agnt";if(-1!=a.indexOf("wicps"))return"wica";if(-1!=a.indexOf("cvpn"))return"cvpn";if(-1!=a.indexOf("mac"))return"macc";if(-1!=a.indexOf("java")||-1!=a.indexOf("plugin"))return logWarning("Unknown/unsupported choice: "+a),"unknown";console.log("Returning client choice: "+a);return a}
function waitForChrome(a){$.ctxsAjax({store:null,async:!1,type:"GET",url:"/cgi/getUserName",dataType:"text",success:function(b,d,c){util.clearAllTimeouts();util.timers.push(window.setTimeout(function(){a("done")},3E3))},error:function(b,d,c){util.timers.push(window.setTimeout(function(){waitForChrome(a)},1E3))},ajax:!1,suppressEvents:!0,refreshSession:!0})}var json={},MasterStore={},fullvpn_form,personalBundlePushed=!1,adminBundlePushed=!1;CTXS.Gateway={};
CTXS.Gateway.bookmarksKnob={getBookmarkDisplayDone:!1,vmwareAppsAggregated:!1,personalBookmarkRefreshNeeded:!0,getHomepageConfigDone:!1,loadedVMwareapps:!1,AdminBookmarksadded:!1};CTXS.Gateway.Apps={hasVmwareApps:!1,hasVmwareDesktops:!1};
var showEnterpriseBookmarks=!0,showPersonalBookmarks=!0,showLogout,gatewayBookmarksKeyword=["GatewayEnterpriseBookmarks"],personalBookmarksKeyword=["GatewayPersonalBookmarks"],vmwareBookmarksKeyword=["vmwareBookmarks"],gatewayBundle={description:_localize("Admin_apps_bundle_descr"),tileid:"appBundle3",title:_localize("Admin_apps_bundle_title"),keywords:gatewayBookmarksKeyword,apps:[]},personalBundle={description:_localize("Personal_apps_bundle_descr"),tileid:"appBundle2",title:_localize("Personal_apps_bundle_title"),
keywords:personalBookmarksKeyword,apps:[]},vmwarebundle={description:_localize("vmware_bundle_descr"),tileid:"appBundle4",title:_localize("vmware_bundle_title"),keywords:vmwareBookmarksKeyword,apps:[]};CTXS.UI.repeatAppGroupTiles=!1;
function choice_resize(){if(LargeUI){var a=Math.max.apply(null,$(".box-content").map(function(){return $(this).outerHeight()}).get());$(".box").outerHeight(a+40)}else{var b=$("#outerbox").height()+44,b=800<b?b:800;$(".authentication-clientchoices-view.web-screen").attr("style",function(a,c){return c+"height:"+b+"px !important;"})}}
function getFormattedTime(a){a=new Date(10*parseInt(a));var b=a.getUTCHours()+":";10>a.getUTCMinutes()&&(b+="0");b+=a.getUTCMinutes()+":";10>a.getUTCSeconds()&&(b+="0");return b+=a.getUTCSeconds()}function logWarning(a){"warn"in console?console.warn(a):console.log(a)}CTXS.SessionMonitor.prototype={start:function(){},refreshed:function(){},stop:function(){}};
function setNSGBaseURL(){function a(a,c,b){logWarning("Resources/List request to SF failed with Error code = "+a.status+". Error msg = "+c);unsetNSGBaseURL();CTXS.Bootstrapper.loadAggregatedStore()}var b=CTXS.getCookie("NSC_BASEURL");UnsetCookie("NSC_FSSO");null!=b&&(b=base64decode(b),"/"!=b.charAt(b.length-1)&&(b+="/"),CTXS.primaryStore.baseUrl=b);CTXS.Controllers.AuthenticationController.prototype._handleAuthenticationFailure=function(a){CTXS.Authentication.clearSavedAuthenticationMethod();a.name==
CTXS.Authentication.Method.GATEWAY&&(logWarning("SSO to SF failed! Displaying only Gateway bookmarks"),unsetNSGBaseURL(),this._completeAuthentication(a,{}))};CTXS.ResourcesClient.requestResources=function(b,c,f,h,e){$.ctxsAjax({store:b,type:"POST",url:c,dataType:"json",data:{format:"json",resourceDetails:f||[CTXS.RESOURCE_DETAILS.DEFAULT]},success:function(a,c,b){(c=b.getResponseHeader(CTXS.CHALLENGE_HEADER))?(a=CTXS.Authentication.parseChallenge(c).reason)&&"notoken"!=a&&"TokenRequired"!=a?CTXS.Events.publish(CTXS.Events.resources.challenged):
CTXS.Events.publish(CTXS.Events.resources.unauthorized,c):(CTXS.Device.isCitrixChromeApp()&&CTXS.Html5Client.postResourcesToChromeApp(a.resources),h(a))},error:a,suppressEvents:!0,refreshSession:!0})};CTXS.ResourcesClient.subscription=function(a,c,b){var h=$.extend({operation:c},a.subscriptionproperties);("subscribe"==c||"update"==c&&"subscribed"==a.subscriptionstatus)&&a.position&&(h["dazzle:position"]=a.position,h.position=a.position);c=a.subscriptionurl;1==a.isGatewayBookmark?(h.appID=a.id,h.nsc_nonce=
CTXS.Gateway.HomePageConfig.NSC_NONCE):c=a.store.baseUrl+a.subscriptionurl;$.ctxsAjax({store:a.store,type:"POST",url:c,data:h,dataType:"json",callErrorHandlerFor503:!0,success:function(c,h,k){k.getResponseHeader(CTXS.CHALLENGE_HEADER)?CTXS.Events.publish(CTXS.Events.resources.challenged):(c=c.subscriptionstatus||c.status)?(a.subscriptionstatus=c,b(a.subscriptionstatus==CTXS.SUBSCRIPTION_STATUS.PENDING?CTXS.SUBSCRIPTION_PENDING:CTXS.SUBSCRIPTION_SUCCESS)):b(CTXS.SUBSCRIPTION_FAILURE)},error:function(){b(CTXS.SUBSCRIPTION_FAILURE)},
refreshSession:!0})}}function unsetNSGBaseURL(){UnsetCookie("NSC_BASEURL");CTXS.primaryStore.baseUrl=""}
function evaluateXPath(a,b,d){var c;if(util.win.ACTIVEX_SUPPORTED)try{return a.setProperty("SelectionLanguage","XPath"),c=a.selectNodes(b),c.getAttribute("position")}catch(f){for(b=0;b<a.getElementsByTagName("subscription").length;b++)if(a.getElementsByTagName("subscription")[b].getAttribute("appID")==d&&(c=a.getElementsByTagName("subscription")[b].getAttribute("position")))return c}else if("evaluate"in document&&(c=a.evaluate(b,a,null,XPathResult.ANY_TYPE,null),a=c.iterateNext(),null!=a))return a.getAttribute("position");
return null}function getSubscriptionStatus(a,b){return CTXS.Gateway.HomePageConfig.SubscriptionsXML?evaluateXPath(CTXS.Gateway.HomePageConfig.SubscriptionsXML,'//subscription[@appID="'+a+'"]',a):null}
(function(a){CTXS.ExtensionAPI.addPlugin({name:"nsg-setclient",initialize:function(){function b(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return a.replace(/[&<>"'/]/ig,function(a){return b[a]})}function d(c,d,h){if(h.responseXML)var e=a(h.responseXML).find("String[id='"+eulaName+"']");0==e.length&&e.text("");c=a('<a href="#" id="nsg-eula-display" style="color:#02A1C1"></a>').text(_localize("eula_terms"));c.click(function(a){a.preventDefault();CTXS.ExtensionAPI.showMessage({localize:!0,
messageText:b(e.text()),messageTitle:"End_User_License_Agreement",okButtonText:"OK",isalert:!1,okAction:function(){}})});d=a('<div><input type="checkbox" id="nsg-eula-accept" tabindex="0"></div>');LargeUI&&d.attr("style","width:385px");h=a('<label for="nsg-eula-accept"></label>').text(_localize("eula_agreement"));h.append(c);d.append(h);eulaDOM=d}setNSGBaseURL();a(document).on("ctxsformsauthenticationauthenticationsuccess",function(){setNSGBaseURL()});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-x1"},
getCredentialTypeMarkup:function(c){return a("<div></div>")}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-setclient"},getCredentialTypeMarkup:function(c){a('<section class="authentication-clientchoices-view  x-scrollable fullscreen-pane web-screen"><header class="gateway store-header theme-header-bgcolor"><div class="logo-container hdpi-capable"></div><span class="header-title theme-header-color phone-only"></span><div class="headerRight"><div class="dropdown-menu-container user-menu"><a id="userMenuBtn" href="#" class="dropdown-menu-trigger settings-button"><p class="theme-header-color user-display-name _ctxstxt_Menu"></p><div class="settings-button-arrow view-sprite"></div></a><div class="dropdown-menu"><div class="dropdown-menu-top"></div><div class="dropdown-menu-body"></div><div class="dropdown-menu-bottom"></div></div></div><a class="help-icon view-sprite" href="#"></a></div></header><div id="outerbox" class="choices_backgrnd"><div class="content_choices"><div id="messageTitle" class="heading _ctxstxt_ClientchoicesTitle"></div><div class="block-container clearfix"></div></div></section>').insertBefore(a(".explicit-auth-view"));
a("#messageTitle").text(_localize("ClientchoicesTitle"));if(isInsideVPN())if(c=getVpnCookie("NSC_VPNERR"),-1<c.indexOf("agent")||-1<c.indexOf("agnt"))c="1,agent";else return triggerFallback(),a("<div> </div>");else c=CTXS.getCookie("NSC_VPNERR");var b=c.split(",");a(".explicit-auth-view").hide();a(".authentication-clientchoices-view").show();var d=a(".authentication-clientchoices-view .block-container");if("1"!=b[0]){var b=a("<div></div>").attr({"class":"box"}),e=a("<a></a>").appendTo(b),e=a("<div></div>").attr({"class":"box-content"}).appendTo(e),
g=a("<div></div>").addClass("box-content-title");a("<p></p>").appendTo(g);a("<p></p>").appendTo(g);var k=a("<div></div>").addClass("box-icon");a("<span></span>").appendTo(k);var l=a("<div></div>").addClass("clientchoices_description");e.append(g,k,l);var e=b.clone(),g=b.clone(),k=b.clone(),l=b.clone(),b=b.clone(),m=a(a(e.add(b))).add(g);m.find("p:first").attr({"class":"_ctxstxt_Network_Access"});g.find("p").eq(1).attr({"class":"_ctxstxt_Connect_with_the_AG_Plugin"});b.find("p").eq(1).attr({"class":"_ctxstxt_Connect_with_the_AG_Plugin_for_MAC"});
k.find("p:first").attr({"class":"_ctxstxt_Clientless_Access"});l.find("p:first").attr({"class":"_ctxstxt_Citrix_XenApp"});m.find(".clientchoices_description").addClass("_ctxstxt_agent_description");k.find(".clientchoices_description").addClass("_ctxstxt_cvpn_description");l.find(".clientchoices_description").addClass("_ctxstxt_ica_description");g.find("a").attr({"class":"agnt"});e.find("a").attr({"class":"plgn"});b.find("a").attr({"class":"macc"});k.find("a").attr({"class":"cvpn"});l.find("a").attr({"class":"wica"});
m.find(".box-icon > span").addClass("full-access");k.find(".box-icon > span").addClass("client-access");l.find(".box-icon > span").addClass("ica-access");-1!=c.indexOf("agent")&&d.append(g);-1!=c.indexOf("mac")&&d.append(b);-1!=c.indexOf("cvpn")&&d.append(k);-1!=c.indexOf("wicps")&&d.append(l);a(".authentication-clientchoices-view .block-container").ctxsLocalize();choice_resize();c=[];d=a(".authentication-clientchoices-view").find(".store-header").find(".user-menu.dropdown-menu-container");c.push({linkId:"menuLogOffBtn_gateway",
linkText:_localize("LogOff"),ariaLabel:_localize("LogOff"),toolTip:null,onClick:function(){CTXS.Environment.logOff()}});new CTXS.Widgets.DropDownMenuWidget(d,a("#user-menu-overlay"),{menuItems:c,menuItemClass:"theme-highlight-color"});CTXS.Environment.getUserDisplayName(function(c){a(".user-display-name").text(c)});a(".box a").on("click",function(a){a.preventDefault();success_callback_choices(a.currentTarget.className)});return a("<div></div>")}return $dummy_content=a("<div> </div>")},getDataToAutoPost:function(c,
b,d){b=a("<p></p>").append(a("<span></span>").attr({"class":"main-text",id:"cvpn_wait_msg"}).text(_localize("cvpn_wait_msg")));var e=a("<img></img>").attr({src:"receiver/images/common/wspinner@2x.gif","class":"loading-spinner"});c.append(b,e);success_callback_choices=function(a){UnsetCookie("NSC_VPNERR");CTXS.removeCookie("NSC_VPNERR");d(a)};c=null;if(isInsideVPN()){if(c=getVpnCookie("NSC_VPNERR"),-1<c.indexOf("agent")||-1<c.indexOf("agnt"))c="1,agent"}else c=CTXS.getCookie("NSC_VPNERR");c=c.split(",");
"1"==c[0]&&success_callback_choices(sendProperChoice(c[1]));return a("<div></div>")}});a(document).on("ctxsformsauthenticationdisplayform",function(c,b){var d=b.authenticationElement.find(".credentialform");d.find("#nsg-x1-logon-button").text(_localize("nsg_LogOnbutton"));d.find("#ns-dialogue-submit").text(_localize("ns_DialogSubmit"));d.find("#cmt").text(_localize("nsg-tlogin-transfer"));d.find("#cmc").text(_localize("nsg-tlogin-cancel"));a(".forms-authentication-button").each(function(){a(this).text(_localize(a(this).text()))});
a(".information").each(function(){a(this).text(_localize(a(this).text()))});a(".confirmation").each(function(){a(this).text(_localize(a(this).text()))});a(".warning").each(function(){a(this).text(_localize(a(this).text()))});a(".inprogress").each(function(){a(this).text(_localize(a(this).text()))});a("#domain > option").each(function(){a(this).text(_localize(a(this).text()));"unspecified"!=a(this)[0].value&&(a(this)[0].value=_localize(a(this)[0].value))})});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-login-label"},
getLabelTypeMarkup:function(c){var b=c.label;null!=c.input&&null!=c.input.assistiveText&&(c.input.assistiveText=_localize(c.input.assistiveText));null!=c.input&&null!=c.input.text&&null!=c.input.text.initialValue&&(c.input.text.initialValue=_localize(c.input.text.initialValue));c=a('<label class="label plain"></label>').attr("for",c.credential.id);b&&c.text(_localize(b.text));return c},parseAsType:function(){return"plain"}});a.widget("ctxs.ctxsFormsAuthentication",a.ctxs.ctxsFormsAuthentication,{_submitForm:function(c){var b=
this,d=this.element.find(".form");if(d.find("#login").is(":visible")&&""==d.find("#login").val())return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"enter_username_msg",messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){b._focusOnFirstInputField()}}),!1;if(d.find("#passwd").is(":visible")&&""==d.find("#passwd").val())return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"enter_password_msg",messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){b._focusOnFirstInputField()}}),
!1;for(var e=1;d.find("#question"+e).length&&d.find("#answer"+e).length;){if(""==d.find("#question"+e).val())return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"enter_question_msg",messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){b._focusOnFirstInputField()}}),!1;if(""==d.find("#answer"+e).val())return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"enter_answer_msg",messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){b._focusOnFirstInputField()}}),
!1;e++}var e=a("#loginBtn"),g=_localize("waitMessage"),g=a("<div></div>").attr("id","wait-message").addClass("standaloneText label plain").attr("role","alert").text(g).css("text-align","center"),g=a("<div></div>").append(g);e.length?g.insertBefore(a("#loginBtn")):g.insertBefore(a("#nsg-x1-logon-button"));c&&"cmt"==c.id&&(c.value="Transfer");c&&"cmc"==c.id&&(c.value="Cancel");var k=b._updateCredentialAndLabelTypesForHeaders({"X-Citrix-AM-CredentialTypes":"none, username, domain, password, newpassword, passcode, savecredentials, textcredential, webview",
"X-Citrix-AM-LabelTypes":"none, plain, heading, information, warning, error, confirmation, image"});CTXS.FormActions.disableFormAndShowHourglass(d,c);b.options.reservedSpace&&b._updateScrollHeight();var l=d.attr("action"),m=b._getFormPostData(c);/\/nf\/auth\/doCredentialUpdate.do|\/nf\/auth\/doAuthentication.do/.test(l)&&window.pass_enc_enable?300<=Math.floor((new Date).getTime()/1E3)-window.pass_enc_server_timestamp?getECDetails(!0,function(){b.encryptPost(l,m,k)}):b.encryptPost(l,m,k):b.options.formProvider(l,
m,k,b._getResponseHandler())},encryptPost:function(a,b,d){var e=this;b=b+"&timestamp="+window.pass_enc_server_timestamp;isInsideVPN()&&checkVPNConfig("AutoSubmitedForm")?(b={dataToEnc:b,key:btoa(arrayBufferToString(window.pass_enc_session_keydata)),iv:btoa(arrayBufferToString(window.pass_enc_iv)),extraFormData:"clt_pubkey="+window.pass_enc_client_key},e.options.formProvider(a,JSON.stringify(b),d,e._getResponseHandler())):encryptData(window.pass_enc_session_key,window.pass_enc_iv,stringToArrayBuffer(b),
function(b){e.options.formProvider(a,"enc_login="+b+"&clt_pubkey="+window.pass_enc_client_key,d,e._getResponseHandler())},encryptionErrHandler)}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-eula"},getCredentialTypeMarkup:function(c){eulaDOM="";""!=c.input.text.initialValue&&(initialValueJson=JSON.parse(base64decode(c.input.text.initialValue)),"name"in initialValueJson&&(eulaName=initialValueJson.name,c=a.globalization.currentCulture().name,""==c&&(c=
"en"),a.ctxsAjax({store:null,type:"GET",url:"/logon/themes/EULA/resources/"+c+".xml",dataType:"xml",async:!1,suppressEvents:!0,success:d,error:function(a,c,b){},refreshSession:!0})));a(document).on("ctxsformsauthenticationdisplayform",function(a,c){var b=c.authenticationElement.find(".credentialform"),d=b.find("#nsg-eula-accept"),k=b.find("#nsg-x1-logon-button");d.length&&k.length&&(k.addClass("disabled").removeAttr("href"),d.on("click",function(){this.checked?k.removeClass("disabled").attr("href",
"#"):k.addClass("disabled").removeAttr("href")}))});return eulaDOM}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"tlogin-failure-msg"},getLabelTypeMarkup:function(c){c=a("<div></div>");var b=a("<p></p>").append(a("<span></span>").attr({id:"tlogin_cancel_title","class":"detail-text"}).text(_localize("tlogin_cancel_title")));c.append(b);return c},parseAsType:function(){return"plain"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-tlogin-heading"},
getLabelTypeMarkup:function(c){return a("<h1></h1>").append(a("<span></span>").attr({id:"nsg-tlogin-heading"}).text(_localize("nsg-tlogin-heading")))},parseAsType:function(){return"plain"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-tlogin-single-res"},getLabelTypeMarkup:function(c){c=a("<div></div>");var b=a("<p></p>").append(a("<span></span>").attr({"class":"detail-text",id:"tlogin_single_res"}).text(_localize("tlogin_single_res")));c.append(b);return c},
parseAsType:function(){return"plain"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-tlogin-multi-res"},getLabelTypeMarkup:function(c){c=a("<div></div>");var b=a("<p></p>").append(a("<span></span>").attr({"class":"detail-text",id:"tlogin_multi_res1"}).text(_localize("tlogin_multi_res1"))),d=a("<p></p>").append(a("<span></span>").attr({"class":"detail-text",id:"tlogin_multi_res2"}).text(_localize("tlogin_multi_res2")));c.append(b,d);return c},parseAsType:function(){return"plain"}});
CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-tlogin"},getLabelTypeMarkup:function(c){var b=a("<div></div>");if(""!=c.input.text.initialValue){c=base64decode(c.input.text.initialValue);try{var d=JSON.parse(c);if(!(d instanceof Array))throw"invalid IIP list";var e=a("<table></table>").attr("id","tlogin-table"),g=a("<tbody></tbody>");g.append(a('<tr><th></th><th class="_ctxstxt_Intranet_IP_Address"></th><th class="_ctxstxt_Idle_Time"></th></tr>'));for(var k=0;k<
d.length;k++){var l=a("<tr></tr>"),m=0==k?a('<td><input type="radio" name="adr" value="'+d[k].adr+'" checked="checked""/></td>'):a('<td><input type="radio" name="adr" value="'+d[k].adr+'"/></td>'),n=a("<td></td>").text(d[k].ip),p=a("<td></td>").text(getFormattedTime(d[k].time));l.append(m,n,p);g.append(l)}e.append(g);e.ctxsLocalize();b.append(e)}catch(q){d=a('<input type="hidden" name="adr" id="adr"/>').val(c),b.append(d)}}return b},parseAsType:function(){return"plain"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-login-heading"},
getLabelTypeMarkup:function(c){c=c.label.text;return a("<h1></h1>").append(a('<span id="login_title" ></span>').text(_localize(c?c:"nsg_loginHeading")))},parseAsType:function(){return"plain"}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-tlogin"},getCredentialTypeMarkup:function(c){return a("<div></div>")}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-fullvpn"},getCredentialTypeMarkup:function(c){return a("<div></div>")},
getDataToAutoPost:function(a,b,d){fullvpn_form=a;checkForCookies();success_callback_fullvpn=function(a){-1!=navigator.platform.indexOf("Win")&&/chrome/.test(navigator.userAgent.toLowerCase())&&-1==navigator.userAgent.toLowerCase().indexOf("edge")?waitForChrome(d):d(a);success_callback_fullvpn=function(){}};AppendVPNDownloadContent(a);secureToken="";null!=b.input.text&&""!=b.input.text.initialValue&&(secureToken=base64decode(b.input.text.initialValue));-1==navigator.platform.indexOf("Win")||!secureToken||
util.useOnlyLocalHostComm||isInsideVPN()?-1!=navigator.platform.indexOf("Linux")&&secureToken&&!util.useOnlyLocalHostComm?(util.fallbackStarted=!1,util.linux.pluginLaunch()):localhostPluginLaunch():(util.fallbackStarted=!1,util.win.pluginLaunch())}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-fullvpn"},getLabelTypeMarkup:function(c){c=a('<div class="vpnconnection_content"></div>');var b=a("<div></div>").attr({id:"nsepadiv"});vpnconnection_heading=a("<p></p>").append(a("<span></span>").attr({id:"Citrix_Access_Gateway",
"class":"_ctxstxt_Citrix_Access_Gateway main-text"}));var d=a("<p></p>").append(a("<span><span>").attr({id:"waitingmsg","class":"_ctxstxt_vpn_waitingmsg detail-text"})),e=a("<p></p>").append(a("<span></span>").attr({id:"If_a_proxy_server_is_configured","class":"_ctxstxt_If_a_proxy_server_is_configured detail-text"})),g=a("<p></p>").append(a("<span></span>").attr({id:"For_more_information_contact_your_help_desk_or_system_administrator","class":"_ctxstxt_For_more_information_contact_your_help_desk_or_system_administrator detail-text"})),
k=a("<div></div>").attr({id:"plugindiv",style:"visibility:hidden"}),l=a("<div></div>").attr({id:"Checking if the plug-in is installed",style:"display:none;"}),m=a("<div></div>").attr({id:"timerValue","class":"detail-text"}),n=a('<div class="connection_spinner"></div>').append(a("<img></img>").attr({src:"receiver/images/common/wspinner@2x.gif","class":"loading-spinner"})),p=a('<div id="scriptArea"></div>');c.append(b,vpnconnection_heading,d,e,g,"<br>",k,n,l,m,p);c.ctxsLocalize();return c},parseAsType:function(){return"plain"}});
CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-hidden"},getCredentialTypeMarkup:function(c){c=base64decode(c.input.text.initialValue);return a('<input type="hidden" name="login" id="login"/>').val(c)}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-auth-failure"},getCredentialTypeMarkup:function(c){return a("<div></div>")},getDataToAutoPost:function(c,b,d){b=a("<img></img>").attr({src:"receiver/images/common/wspinner@2x.gif",
"class":"loading-spinner"});c.append(b);d("done")}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-auth-success"},getCredentialTypeMarkup:function(c){UnsetCookie("CsrfToken");return a("<div></div>")},getDataToAutoPost:function(c,b,d){b=a("<img></img>").attr({src:"receiver/images/common/wspinner@2x.gif","class":"loading-spinner"});c.append(b);d("done")}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-epa-success"},
getCredentialTypeMarkup:function(c){UnsetCookie("CsrfToken");return a("<div></div>")},getDataToAutoPost:function(c,b,d){b=a("<img></img>").attr({src:"receiver/images/common/wspinner@2x.gif","class":"loading-spinner"});c.append(b);d("done")}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-l20n"},getLabelTypeMarkup:function(c){c=c.label;if("LoginFail"==c.text){c="_ctxstxt_errorMessageLabel"+CTXS.getCookie("NSC_VPNERR");var b=a("<div></div>").attr({id:"access_denied_title",
"class":"main-text error"});b.addClass(c);c=a("<div></div>").append(b);c.ctxsLocalize();UnsetCookie("NSC_VPNERR");CTXS.removeCookie("NSC_VPNERR");return c}"GenericError"==c.text&&(epaerrormsg=CTXS.getCookie("NSC_ERRM"))?(c=a("<p></p>").append(a("<span></span>").attr("class","detail-text").text(epaerrormsg)),UnsetCookie("NSC_ERRM")):(c=_localize(c.text),c=a("<p></p>").append(a("<span></span>").attr("class","detail-text").text(c)));return c},parseAsType:function(){return"error"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"nsg-l20n-error"},
getLabelTypeMarkup:function(c){c=c.label;c=isNaN(c.text)?_localize(c.text):_localize("errorMessageLabel"+c.text);return a("<p></p>").append(a("<span></span>").attr("class","detail-text error").text(c))},parseAsType:function(){return"error"}});CTXS.ExtensionAPI.addCustomAuthLabelHandler({getLabelTypeName:function(){return"certauth-failure-msg"},getLabelTypeMarkup:function(c){var b=c.label;c=a("<div></div>");var d=a("<h1></h1>").attr({"class":""}).append(a("<span></span>").text(_localize("cert_auth_msg_title"))),
b=a("<p></p>").append(a("<span></span>").text(_localize(b.text)));c.append(d,b);return c},parseAsType:function(){return"error"}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"nsg-l20n"},getCredentialTypeMarkup:function(c){return a("<div></div>")}});CTXS.ExtensionAPI.addCustomCredentialHandler({getCredentialTypeName:function(){return"GoBack"},getCredentialTypeMarkup:function(c){return a("<div></div>").attr("class","buttonsrow").append(a("<div></div>").attr("class",
"multiple-buttons").append(a("<a></a>").attr({id:"GoBack","class":"button forms-authentication-button last-child default",href:"#"}).text(_localize("nsg_GoBack"))))}});CTXS.AuthClient.logOff=function(c,b,d){var e=a.Deferred();c=a.extend({},{type:"POST",dataType:"xml",refreshSession:!0},{url:CTXS.primaryStore.baseUrl+c,suppressEvents:!0,complete:function(c){if(200==c.status){var k=a(c.responseXML).find("AuthenticateResponse").find("RedirectURL");k.length?window.open(k.text(),"_parent"):(CTXS.primaryStore.baseUrl.length&&
doGatewayLogoff(),CTXS.trace("CTXS.AuthClient.logOff is complete and status = {0}".format(c&&c.status)),b&&b(),e.resolve())}else CTXS.trace("CTXS.AuthClient.logOff returned error status = {0}".format(c&&c.status)),d&&d(),e.reject()},refreshSession:!1});a.ctxsAjax(c);return e.promise()}},preProcessAppData:function(a,d){MasterStore=a;json=d;json.bundles||(json.bundles=[]);for(var c=0;c<json.resources.length;c++)json.resources[c].iconurl=CTXS.primaryStore.baseUrl+json.resources[c].iconurl;CTXS.removeCookie("CtxsPasswordChangeAllowed");
aggregateAllApps(a)},afterDisplayHomeScreen:function(){LargeUI&&a(".store-toolbar").show();PB_addbox_shown=!1;var b=a("<div></div>").attr({"class":"theme-highlight-color personal_bm_dropdown _ctxstxt_Bookmark"});showPersonalBookmarks&&LargeUI?b.text(_localize("Bookmark")):LargeUI&&b.text(_localize("Go"));var d=a("<div></div>").addClass("PB_heading").append(a("<span></span>").attr({"class":"bookmark_heading_label _ctxstxt_Bookmark"})),c=a("<div></div>").addClass("PB_row").append(a("<label></label>"),
a("<input></input>").attr({type:"text"}));c.find("input").blur(function(){this.value=removeSpaces(this.value)});var f=c.clone(!0,!0),h=c.clone(!0,!0),e=c.clone(!0,!0),g=a("<input></input>").attr({type:"hidden",id:"nsc_nonce",name:"nsc_nonce",value:CTXS.Gateway.HomePageConfig.NSC_NONCE}),k=a("<input></input>").attr({type:"hidden",id:"UI_inuse",name:"UI_inuse",value:"RfWeb"});f.find("input").attr({id:"pb_url",name:"url"});h.find("input").attr({name:"title"});e.find("input").attr({name:"desc"});f.find("label").attr({"class":"_ctxstxt_PB_url"});
h.find("label").attr({"class":"_ctxstxt_PB_name"});e.find("label").attr({"class":"_ctxstxt_PB_description"});var l=a("<div></div>").addClass("PB_footerbutton").append(a("<button></button>").attr({"class":"pb_button ca _ctxstxt_save",value:"Done",id:"PB_add_submit"})),m=a("<form></form>").attr({"class":"",action:"",id:"PB__add_form",name:"newbm"});m.append(d,f);if("True"==CTXS.Gateway.HomePageConfig.UserDefinedRDP.Enabled){var n=c.clone(!0,!0);n.find("input").attr({type:"checkbox",name:"isRDP",id:"isRDP",
style:"cursor:pointer"});n.append(a("<label></label>").attr({"for":"isRDP",id:"isRDP_label","class":"_ctxstxt_rdplinkChecklabel"}),a("<img></img>").attr({src:"/logon/LogonPoint/receiver/images/common/icon-help.png",style:"float:right",id:"bookmark_help"}));m.append(n)}showPersonalBookmarks&&m.append(h,e);m.append(g,k);showPersonalBookmarks&&m.append(l);d=a("<div></div>").attr({"class":"large personal_bm_addbox",style:"display:none"}).append(m);d.appendTo(b);LargeUI?(b.addClass("large"),d.addClass("large"),
b.insertBefore(a(".breadcrumb-container")),a('.personal_bm_addbox input[type="text"]#pb_url').css("width","435px")):SmallUI&&(b.addClass("small"),d.addClass("small"),b.insertBefore(a(".view-buttons")),a([f,e,h]).each(function(){this.find("label").hide()}),"True"==CTXS.Gateway.HomePageConfig.UserDefinedRDP.Enabled&&n.find("label:first").hide(),f.find("input").attr("placeholder",_localize("Enter_url_placeholder")),h.find("input").attr("placeholder",_localize("Enter_name_placeholder")),e.find("input").attr("placeholder",
_localize("Enter_description_placeholder")),a('.personal_bm_addbox input[type="text"]#pb_url').css("width","100%"));if(a.parseJSON(CTXS.Gateway.HomePageConfig.CVPNEnabled.toLowerCase())||"True"==CTXS.Gateway.HomePageConfig.UserDefinedRDP.Enabled)f.append(a("<button></button>").attr({value:"Go","class":"pb_button go _ctxstxt_Go"})),LargeUI?a('.personal_bm_addbox input[type="text"]#pb_url').css("width","379px"):a('.personal_bm_addbox input[type="text"]#pb_url').css("width","77%"),a(".pb_button.go").click(function(c){c=
{urls:[]};var b=document.forms.newbm.url.value;if(""==b)return error_message="PersonalBookmark_error4",CTXS.ExtensionAPI.showMessage({localize:!0,messageText:error_message,messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){}}),!1;document.forms.newbm.isRDP&&1==document.forms.newbm.isRDP.checked?(c="/rdpproxy/"+document.forms.newbm.url.value,""!=CTXS.Gateway.HomePageConfig.UserDefinedRDP.RDPListener&&(c+="/"+CTXS.Gateway.HomePageConfig.UserDefinedRDP.RDPListener),openCVPnizedUrl(c)):
a.parseJSON(CTXS.Gateway.HomePageConfig.CVPNEnabled.toLowerCase())&&(c.urls.push(b),PB_submit("/cgi/cvpnizeUrl",c));return!1});showPersonalBookmarks&&a("#PB_add_submit").click(function(a){if(!bmCheck())return!1;addnewPB("/vpns/portal/scripts/newbm.pl");document.forms.newbm.isRDP&&(document.forms.newbm.isRDP.checked=!1);return!1});a("#bookmark_help").click(function(a){CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"RDP_hint",messageTitle:"Help",okButtonText:"OK",isalert:!1,okAction:function(){}})});
a("body").on("click",function(c){!(1!==a(c.target).closest(".personal_bm_dropdown").length||a(c.target).hasClass("personal_bm_dropdown")&&PB_addbox_shown)||1===a(c.target).closest(".messageBoxPopup").length&&PB_addbox_shown?(PB_addbox_shown=!0,b.addClass("personal_bm_dropdown_hover"),a(".personal_bm_addbox").show()):(PB_addbox_shown=!1,b.removeClass("personal_bm_dropdown_hover"),a(".personal_bm_addbox").hide())});showPersonalBookmarks||(a(".personal_bm_addbox").css("height","95px"),a("._ctxstxt_Bookmark").each(function(){a(this).addClass("_ctxstxt_Go");
a(this).removeClass("_ctxstxt_Bookmark")}));"True"==CTXS.Gateway.HomePageConfig.PCOIPEnabled&&(CTXS.Gateway.bookmarksKnob.vmwareAppsAggregated||aggregateVMWareapps());DeleteButton=a('<a id="appInfoDeleteBtn" href="#" class="theme-highlight-color theme-highlight-border-color appInfoActionButton _ctxstxt_Delete"></a>');DeleteButton.text(_localize("Delete"));a(".appInfoActions").append(DeleteButton);CTXS.Widgets.AppInfoWidget.prototype.displayButtons=function(c){this.$DeleteBtn=this.$actionButtons.find("#appInfoDeleteBtn");
var b=this.$addBtn.is(":visible"),d=this.$removeBtn.is(":visible"),f=this.$requestBtn.is(":visible"),h=this.$cancelBtn.is(":visible");wasDeleteVisible=this.$DeleteBtn.is(":visible");var e=c.canOpen(),g=c.canBeAdded(),k=c.canBeRequested(),l=c.canBeRemoved(),m=c.canCancelRequest();canDelete=c.isPersonalBookmark?!0:!1;this.$openBtn.toggleClass("show",e);this.$openBtn.attr("aria-hidden",!e);c.isGatewayBookmark&&this.$openBtn.attr("href",c.content);this.$DeleteBtn.toggleClass("show",!1);this.$DeleteBtn.toggleClass("show",
canDelete);this.$actionButtons.find("#appInfoOpenBtn");this.$requestBtn.toggleClass("show",k);this.$requestBtn.attr("aria-hidden",!k);this.$addBtn.toggleClass("show",g);this.$addBtn.attr("aria-hidden",!g);this.$removeBtn.toggleClass("show",l);this.$removeBtn.attr("aria-hidden",!l);this.$cancelBtn.toggleClass("show",m);this.$cancelBtn.attr("aria-hidden",!m);c.isAddInProgress||c.isRemoveInProgress||(b&&l?this.$removeBtn.focus():d&&g?this.$addBtn.focus():f&&m?this.$cancelBtn.focus():h&&k?this.$requestBtn.focus():
this.$actionButtons.find(".appInfoActionButton:focusable").first().focus(),this.$DeleteBtn.off("click").on("click",function(b){b.preventDefault();a.ctxsAjax({url:"/vpns/portal/scripts/rmbm.pl",data:{AppToDelete:c.name,nsc_nonce:CTXS.Gateway.HomePageConfig.NSC_NONCE,UI_inuse:"RfWeb",appID:c.id},type:"POST",async:!0,success:PersonalBookmarkDeleted,suppressEvents:!0,error:function(a,c,b){console.log("Error in deleting Personal Bookmark")},refreshSession:!0})}))};showLogout||a("#menuLogOffBtn").hide();
a(".personal_bm_dropdown").ctxsLocalize()},getAppTileMarkup:function(a,d,c){return a.isGatewayBookmark?c().replace('<a href="#" class="storeapp-details-link">','<a href="'+a.content+'" class="storeapp-details-link">'):c()}})})(jQuery);
function doGatewayLogoff(){$.ctxsAjax({store:null,type:"POST",url:"Authentication/LogOff",dataType:"text",async:!1,refreshSession:!0,success:function(a){a=$(a.responseXML).find("AuthenticateResponse").find("RedirectURL");a.length&&window.open(a.text(),"_parent")},error:function(a){console.error("Error doing authentication/logoff - "+a)}})}function PersonalBookmarkDeleted(){CTXS.Gateway.bookmarksKnob.personalBookmarkRefreshNeeded=!0;CTXS.Controllers.ViewController.revertView();refreshApps()}
function makeJSsafe(a){for(var b=[{original:/&/g,replacement:"&amp;"},{original:/</g,replacement:"&lt;"},{original:/>/g,replacement:"&gt;"},{original:/"/g,replacement:"&quot;"},{original:/'/g,replacement:"&apos;"}],d=0;d<b.length;d++)a=a.replace(b[d].original,b[d].replacement);return a}function removeSpaces(a){""!=a&&(a=a.replace(/^\s+|\s+$/gm,""));return a}
function bmCheck(a){a=document.forms.newbm.url.value;var b=document.forms.newbm.title.value,d=document.forms.newbm.desc.value,c;if(""==a)return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"PersonalBookmark_error1",messageTitle:"Personal_Bookmark",okButtonText:"OK",isalert:!1,okAction:function(){}}),!1;if(""==b)return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"PersonalBookmark_error2",messageTitle:"Personal_Bookmark",okButtonText:"OK",isalert:!1,okAction:function(){}}),!1;if(0==
a.indexOf("\\"))return CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"PersonalBookmark_error3",messageTitle:"Personal_Bookmark",okButtonText:"OK",isalert:!1,okAction:function(){}}),!1;document.forms.newbm.isRDP&&(c=document.forms.newbm.isRDP.checked);c&&(a="rdp://"+a);document.forms.newbm.url.value=encodeURI(a);document.forms.newbm.title.value=makeJSsafe(b);document.forms.newbm.desc.value=makeJSsafe(d);return!0}
function PB_submit(a,b){var d=b.urls;for(i=0;i<d.length;i++)0!=d[i].indexOf("http://")&&0!=d[i].indexOf("https://")&&(d[i]="http://"+d[i]),d[i]=encodeURIComponent(d[i]);$.ctxsAjax({url:a,data:"cvpnizeUrl="+JSON.stringify(b),type:"POST",dataType:"text",async:!0,suppressEvents:!0,success:openCVPnizedUrl,error:function(a,b,d){alert("Error in fetching cvpnized URl")},refreshSession:!0});PB_addbox_shown&&(PB_addbox_shown=!1,$(".personal_bm_dropdown").removeClass("personal_bm_dropdown_hover"),$("#PB__add_form").find("input[type=text], textarea").val(""),
$(".personal_bm_addbox").hide())}function addnewPB(a){var b=$("#PB__add_form").serialize();PB_addbox_shown&&(PB_addbox_shown=!1,$(".personal_bm_dropdown").removeClass("personal_bm_dropdown_hover"),$("#PB__add_form").find("input[type=text], textarea").val(""),$(".personal_bm_addbox").hide());$.ctxsAjax({url:a,data:b,type:"POST",async:!0,success:newPBadded,suppressEvents:!0,error:function(a,c,b){console.log("Error in adding personal bookmarks")},refreshSession:!0})}
function newPBadded(){CTXS.Gateway.bookmarksKnob.personalBookmarkRefreshNeeded=!0;refreshApps()}function refreshApps(){personalBundle.apps=[];CTXS.Environment.refresh()}function openCVPnizedUrl(a,b,d){a=JSON.parse(decodeURIComponent(a)).urls[0];(a=window.open(a,"_blank"))?a.focus():CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"Allow_popups",messageTitle:"",okButtonText:"OK",isalert:!1,okAction:function(){}})}
function aggregateAllApps(a){getHomepageConfig(a);getBoomarksDisplay();aggregatePersonalBookmarks(a);aggregateAdminBookmarks(a);mixvmwareapps(a);getSFHomeConfig(a)}
function getHomepageConfig(a){function b(a,c,b){CTXS.Gateway.HomePageConfig=a;"Enabled"==a.PasswordChange&&CTXS.setCookie("CtxsPasswordChangeAllowed","true");showLogout=-1!=navigator.platform.indexOf("Win")?"Enabled"==a.AlwaysOnClientControls?!0:!1:!0;"0"<=a.DaysForPwdExp?$(".home-view").find(".pwd-exp-days").text(a.DaysForPwdExp+" days for password expiry "):$(".home-view").find(".pwd-exp-days").hide();CTXS.Gateway.bookmarksKnob.getHomepageConfigDone=!0}CTXS.Gateway.bookmarksKnob.getHomepageConfigDone||
$.ctxsAjax({store:a,type:"GET",url:"/cgi/getHomepageConfig",dataType:"json",async:!1,suppressEvents:!0,success:b,error:function(a,c,b){console.log("Error in getting HomePage Config")},refreshSession:!0})}var noOfPB=0,personalBookmarkJSON;
function aggregatePersonalBookmarks(a){function b(a,b,d){function e(a,b,c){a=JSON.parse(decodeURIComponent(a));for(b=0;b<$xmlobject.find("bookmark").length;b++)$($xmlobject.find("bookmark")[b]).attr("url",a.urls[b])}personalBookmarkJSON={resources:[],bundles:[]};$xmlobject=$(d.responseXML).find("Bookmarks");a={urls:[]};CTXS.Gateway.HomePageConfig.SubscriptionsXML=d.responseXML;if(!1!==showPersonalBookmarks){for(d=0;d<$xmlobject.find("bookmark").length;d++)a.urls.push($($xmlobject.find("bookmark")[d]).attr("url"));
$.parseJSON(CTXS.Gateway.HomePageConfig.CVPNEnabled.toLowerCase())&&$.parseJSON(CTXS.Gateway.HomePageConfig.CVPN_V2.toLowerCase())&&$.ctxsAjax({url:"/cgi/cvpnizeUrl",data:"cvpnizeUrl="+JSON.stringify(a),type:"POST",dataType:"text",async:!1,suppressEvents:!0,success:e,error:function(a,b,c){console.log("Error in CVPNizing personal bookmarks for CVPN_V2")},refreshSession:!0});for(d=0;d<$xmlobject.find("bookmark").length;d++){a={clienttypes:[],content:"",iconurl:"/logon/LogonPoint/receiver/images/common/personal_BM_image.png",
id:"",isGatewayBookmark:!0,isPersonalBookmark:!0,launchurl:"",playlists:[],shortcutvalidationurl:"",subscriptionstatus:"unsubscribed",subscriptionurl:CTXS.Gateway.HomePageConfig.GatewayBaseURL+"/vpns/portal/scripts/subscription.pl"};a.content=$($xmlobject.find("bookmark")[d]).attr("url");b=base64decode($($xmlobject.find("bookmark")[d]).attr("title"));var g=base64decode($($xmlobject.find("bookmark")[d]).attr("descr"));window.atob&&(b=decodeURIComponent(escape(b)),g=decodeURIComponent(escape(g)));a.name=
b;a.description=g;g=Base64.encode(b+".pb");$($xmlobject.find("bookmark")[d]).attr("title",b);a.id=b+".pb";b=getSubscriptionStatus(g);null!=b&&(a.subscriptionstatus="subscribed",a.position=b);0==a.content.indexOf("rdp://")&&(a.content=window.location.origin+"/rdpproxy/"+a.content.substring(6),b=a.content.split("?"),""!=CTXS.Gateway.HomePageConfig.UserDefinedRDP.RDPListener&&("/"!=b[0].charAt(b[0].length-1)&&(b[0]+="/"),b[0]+=CTXS.Gateway.HomePageConfig.UserDefinedRDP.RDPListener),a.content=b[1]?b[0]+
"?"+b[1]:b[0],a.isdesktop="true",a.iconurl="/vpn/media/Desktop.png");a.playlists.push=$($xmlobject.find("bookmark")[d]).attr("title");a.path="\\"+_localize("Personal_apps_title");a.keywords=personalBookmarksKeyword;json.resources.push(a);personalBookmarkJSON.resources.push(a)}if(noOfPB=d)json.bundles.push(personalBundle),personalBookmarkJSON.bundles.push(personalBundle),personalBundlePushed=!0}}if(CTXS.Gateway.bookmarksKnob.personalBookmarkRefreshNeeded)$.ctxsAjax({data:"nsc_nonce="+CTXS.Gateway.HomePageConfig.NSC_NONCE,
store:a,type:"POST",url:CTXS.Gateway.HomePageConfig.GatewayBaseURL+"/vpns/portal/scripts/PersonalBookmark.pl",dataType:"xml",async:!1,suppressEvents:!0,success:b,error:function(a,b,d){logWarning("Error in Fetching Personal Bookmarks.")},refreshSession:!0});else{if(personalBookmarkJSON)for(var d=0;d<personalBookmarkJSON.resources.length;d++)json.resources.push(personalBookmarkJSON.resources[d]);d&&(json.bundles.push(personalBundle),personalBundlePushed=!0)}}var vmwareApps={resources:[]};
function mixvmwareapps(a){$(".store-apps-container").on("click",".storeapp-details-link",function(b){var c=$(this).closest(".storeapp"),c=CTXS.Views.AppView.getAppShortId(c);checkifVMwareApp(b,a,c)});if(CTXS.Gateway.bookmarksKnob.loadedVMwareapps){for(var b=0;b<vmwareApps.resources.length;b++)json.resources.push(vmwareApps.resources[b]);if(b){$("body").find(".home-view").find(".no-apps-or-desktops-message").hide();var d="apps"===CTXS.Config.getConfigValue("userInterface.uiViews.defaultView")&&"true"===
CTXS.Config.getConfigValue("userInterface.uiViews.showAppsView")&&CTXS.Gateway.Apps.hasVmwareApps,c="desktops"===CTXS.Config.getConfigValue("userInterface.uiViews.defaultView")&&"true"===CTXS.Config.getConfigValue("userInterface.uiViews.showDesktopsView")&&CTXS.Gateway.Apps.hasVmwareDesktops;d?CTXS.Events.publish(CTXS.Events.ui.showAllApps):c?CTXS.Events.publish(CTXS.Events.ui.showDesktops):CTXS.Events.publish(CTXS.Events.ui.showMyApps)}b&&adminBundlePushed&&personalBundlePushed?(json.bundles.splice(json.bundles.length-
2,0,vmwarebundle),console.log(json.resources)):b&&(adminBundlePushed||personalBundlePushed)?json.bundles.splice(json.bundles.length-1,0,vmwarebundle):b&&json.bundles.push(vmwarebundle)}}function failCb(){console.log("VMware client not installed");CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"vmware_install_reqd_msg",messageTitle:"vmware_missing_title",okButtonText:"OK",isalert:!1,okAction:function(){}})}function successCb(){}
function checkifVMwareApp(a,b,d){(b=CTXS.Store.getAppByShortId(d))&&b.isVMWareApp&&(b.isLaunchInProgress?1==b.tries&&(b.isLaunchInProgress=!1,b.tries=0):(b.tries=1,b.isLaunchInProgress=!0,window.protocolCheck(b.content,failCb,successCb),a.preventDefault(),a.stopPropagation()))}
function aggregateVMWareapps(){var a=CTXS.getCookie("NSC_AAAC");a&&(a=Base64.encode(a));$.ctxsAjax({type:"GET",url:"/cgi/pcoip",dataType:"xml",async:!1,suppressEvents:!0,success:function(b,d,c){var f=$($(c.responseXML).find("launch-items")).find("desktops");c=$($(c.responseXML).find("launch-items")).find("applications");b={clienttypes:[],iconurl:"/vpn/media/Desktop.png",id:"",launchurl:"",playlists:[],isVMWareApp:!0,isGatewayBookmark:!0,shortcutvalidationurl:"",subscriptionstatus:"unsubscribed",subscriptionurl:CTXS.Gateway.HomePageConfig.GatewayBaseURL+
"/vpns/portal/scripts/subscription.pl"};var h;for(h=0;h<f.find("desktop").length;h++){d=$.extend(!0,{},b);for(var e=$($(f.find("desktop")[h]).find("protocols")).find("protocol"),g=0;g<e.length;g++)if("PCOIP"==$(e[g]).find("name").text()){d.pcoip=!0;break}1==d.pcoip&&(e=window.location.host,g=$(f.find("desktop")[h]).find("id").text(),d.content="vmware-view://"+e+"/"+escape(g)+"?SAMLart="+a,d.name=$($(f.find("desktop")[h]).find("name")[0]).text(),d.playlists.push(d.name),d.path="\\"+_localize("vmware_apps_title"),
d.id=d.name+".vmware",e=getSubscriptionStatus(Base64.encode(d.id)),null!=e&&(d.subscriptionstatus="subscribed",d.position=e),d.isdesktop="true",d.keywords=vmwareBookmarksKeyword,vmwareApps.resources.push(d))}CTXS.Gateway.Apps.hasVmwareDesktops=h?!0:!1;for(f=0;f<c.find("application").length;f++){d=$.extend(!0,{},b);e=$($(c.find("application")[f]).find("protocols")).find("protocol");for(g=0;g<e.length;g++)if("PCOIP"==$(e[g]).find("name").text()){d.pcoip=!0;break}if(1==d.pcoip){e=window.location.host;
h=$(c.find("application")[f]).find("id").text();d.content="vmware-view://"+e+"/"+escape(h)+"?SAMLart="+a;d.name=$($(c.find("application")[f]).find("name")[0]).text();d.playlists.push(d.name);d.path="\\"+_localize("vmware_apps_title");d.id=d.name;d.keywords=vmwareBookmarksKeyword;h=$($(c.find("application")[f]).find("icons")[0]).find("icon");for(e=0;e<h.length;e++)"48"==$(h[e]).find("width").text()&&(d.iconurl=$(h[e]).find("path").text());vmwareApps.resources.push(d)}}CTXS.Gateway.Apps.hasVmwareApps=
f?!0:!1;CTXS.Gateway.bookmarksKnob.loadedVMwareapps=!0;CTXS.Gateway.bookmarksKnob.personalBookmarkRefreshNeeded=!1;refreshApps();CTXS.Gateway.bookmarksKnob.vmwareAppsAggregated=!0},error:function(a,d,c){console.log("Error in getting VMware resources")},refreshSession:!0})}
function logOffWebUI(){$.ctxsAjax({data:"",type:"GET",url:"/cgi/pcoiplogout",dataType:"text",async:!1,suppressEvents:!0,success:function(){CTXS.Environment.logOff()},error:function(a,b,d){CTXS.Environment.logOff();logWarning("Error in loggin out of PCOIP session")},refreshSession:!0})}var AdminBookmarksJSON;
function aggregateAdminBookmarks(a){function b(a,b,f){AdminBookmarksJSON={resources:[],bundles:[]};"false"==CTXS.getCookie("CtxsPasswordChangeAllowed")&&UnsetCookie("CtxsPasswordChangeAllowed");for(b=0;b<a.resources.length&&(0!=a.resources[b].content.indexOf("\\\\")||(a.resources.splice(b,1),b!=a.resources.length));b++)a.resources[b].subscriptionstatus="unsubscribed",delete a.resources[b].position,a.resources[b].content=a.resources[b].content.replace(/\s/g,"").replace(/&#32;/g,""),f=getSubscriptionStatus(Base64.encode(a.resources[b].id)),
null!=f&&(a.resources[b].subscriptionstatus="subscribed",a.resources[b].position=f),a.resources[b].subscriptionurl=CTXS.Gateway.HomePageConfig.GatewayBaseURL+"/vpns/portal/scripts/subscription.pl",a.resources[b].appinfourl=null,a.resources[b].isGatewayBookmark=!0,a.resources[b].path="\\"+_localize("Admin_apps_title"),a.resources[b].keywords=gatewayBookmarksKeyword,json.resources.push(a.resources[b]),AdminBookmarksJSON.resources.push(a.resources[b]),a.resources[b].iconurl=encodeURI($("<textarea/>").html(a.resources[b].iconurl).val()),
""==a.resources[b].iconurl&&(a.resources[b].iconurl="/vpn/media/enterprise_bm_logo.png"),-1!=a.resources[b].content.indexOf("/rdpproxy/")&&(a.resources[b].iconurl="/vpn/media/Desktop.png"),"Email Home"==a.resources[b].id&&(a.resources[b].id=a.resources[b].description=a.resources[b].name=a.resources[b].playlists[0]=_localize("NsgEmail_AppName"));b&&1==personalBundlePushed?(json.bundles.splice(json.bundles.length-1,0,gatewayBundle),AdminBookmarksJSON.bundles.push(gatewayBundle),adminBundlePushed=!0):
b&&(json.bundles.push(gatewayBundle),AdminBookmarksJSON.bundles.push(gatewayBundle),adminBundlePushed=!0);CTXS.Gateway.bookmarksKnob.AdminBookmarksadded=!0}if(showEnterpriseBookmarks)if(CTXS.Gateway.bookmarksKnob.AdminBookmarksadded){for(a=0;a<AdminBookmarksJSON.resources.length;a++)json.resources.push(AdminBookmarksJSON.resources[a]);a&&1==personalBundlePushed?json.bundles.splice(json.bundles.length-1,0,gatewayBundle):a&&json.bundles.push(gatewayBundle)}else $.ctxsAjax({store:a,type:"GET",url:"/cgi/resources/list",
dataType:"json",async:!1,suppressEvents:!0,success:b,error:function(a,b,f){console.log("Error in getting Gateway Resource List or Invalid JSON.")},refreshSession:!0})}var HomeconfigBackupTaken=!1;
function getSFHomeConfig(a){if(""!=CTXS.primaryStore.baseUrl){var b=function(a,b,f){b=$.extend({},CTXS.Config._config);CTXS.Config.loadConfiguration(a);CTXS.Config._config.storeProxy.resourcesProxy.listURL=b.storeProxy.resourcesProxy.listURL;CTXS.Config._config.authManager.changeCredentialsURL=b.authManager.changeCredentialsURL;CTXS.Config._config.pluginAssistant.showAfterLogin=b.pluginAssistant.showAfterLogin;CTXS.Config._config.pluginAssistant.showOnlyIfRequiredByApps=b.pluginAssistant.showOnlyIfRequiredByApps;
CTXS.Config._config.userInterface.receiverConfiguration.showOnlyIfRequiredByApps=b.userInterface.receiverConfiguration.showOnlyIfRequiredByApps;HomeconfigBackupTaken=!0;if(!CTXS.Device.isProtocolHandlerSupported()||"true"!==CTXS.Config.getConfigValue("pluginAssistant.protocolHandler.enabled")||CTXS.Device.isMobileDevice()||CTXS.Html5Client.isMandatory())CTXS.removeCookie(CTXS.ClientDetection.COOKIE_IS_PASSTHROUGH),CTXS.removeCookie(CTXS.ClientDetection.COOKIE_CLIENT_VERSION),CTXS.setCookie(CTXS.ClientDetection.COOKIE_CLIENT_DETECTION_DONE,
"true",!0)};HomeconfigBackupTaken||$.ctxsAjax({store:a,type:"POST",url:CTXS.primaryStore.baseUrl+"Home/Configuration",dataType:"xml",async:!1,suppressEvents:!0,success:b,error:$.noop,refreshSession:!0})}}
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",d,c,f,h,e,g,k=0;for(a=Base64._utf8_encode(a);k<a.length;)d=a.charCodeAt(k++),c=a.charCodeAt(k++),f=a.charCodeAt(k++),h=d>>2,d=(d&3)<<4|c>>4,e=(c&15)<<2|f>>6,g=f&63,isNaN(c)?e=g=64:isNaN(f)&&(g=64),b=b+this._keyStr.charAt(h)+this._keyStr.charAt(d)+this._keyStr.charAt(e)+this._keyStr.charAt(g);return b},decode:function(a){var b="",d,c,f,h,e,g=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");g<
a.length;)d=this._keyStr.indexOf(a.charAt(g++)),c=this._keyStr.indexOf(a.charAt(g++)),h=this._keyStr.indexOf(a.charAt(g++)),e=this._keyStr.indexOf(a.charAt(g++)),d=d<<2|c>>4,c=(c&15)<<4|h>>2,f=(h&3)<<6|e,b+=String.fromCharCode(d),64!=h&&(b+=String.fromCharCode(c)),64!=e&&(b+=String.fromCharCode(f));return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",d=0;d<a.length;d++){var c=a.charCodeAt(d);128>c?b+=String.fromCharCode(c):(127<c&&2048>c?b+=String.fromCharCode(c>>
6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),b+=String.fromCharCode(c&63|128))}return b},_utf8_decode:function(a){for(var b="",d=0,c=c1=c2=0;d<a.length;)c=a.charCodeAt(d),128>c?(b+=String.fromCharCode(c),d++):191<c&&224>c?(c2=a.charCodeAt(d+1),b+=String.fromCharCode((c&31)<<6|c2&63),d+=2):(c2=a.charCodeAt(d+1),c3=a.charCodeAt(d+2),b+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63),d+=3);return b}};
if(-1!=navigator.platform.indexOf("Mac")||-1!=navigator.platform.indexOf("Win"))var nsloc=document.location.href;else-1!=navigator.platform.indexOf("Linux")&&(nsloc=document.location.protocol+"//"+document.location.host,""!=document.location.port&&(nsloc=nsloc+":"+document.location.port));
var ns_aaac="",ns_new_aaac="",NS_OLD_COOKIE_LEN=32,aaacCookie="NSC_AAAC",timerID=0,probeErrors=0,agentPort=3148,image,postEPACookie="NSC_EPAFALLBACK",ns_postepa="",curTimerValue=20,showTimerHandler,vpnErrCookie="NSC_VPNERR",nsVersion="11.1.0.0",require64bitPlugin=!1,CheckMACPluginInstalled,plugin_connected=!1,supports65BytesCookie=!1;function UnsetCookie(a){document.cookie=a+"=nothing;expires=Thursday, 1 Jan 1970 00:00:00 GMT; path=/"}
function nextAgentPort(){agentPort+=1;3150<agentPort&&(agentPort=3148)}function setChoicesCookiesMac(){if(navigator.mimeTypes["application/citrix-agmacplugin"]){document.getElementById("scriptArea").innerHTML='<OBJECT id="npobj" type="application/citrix-agmacplugin" height="1" width="1"></OBJECT>';for(var a=document.getElementById("npobj").nsCookies.split(";"),b=0;b<a.length;b++)document.cookie=a[b]+";path=/; secure"}}
function checkIfAgentReady(){try{timerID&&window.clearTimeout(timerID),navigator.plugins.refresh(!1),CheckMACPluginInstalled=setTimeout("checkIfInstalledAndDoLogin()",1E3),document.getElementById("Checking if the plug-in is installed").style.display="",document.getElementById("timerValue").innerHTML=curTimerValue+" "+_localize("secs"),setTimeout("updateTimer()",1E3)}catch(a){timerID&&window.clearTimeout(timerID),displayDownloadArea(),timerID=window.setTimeout(function(){checkIfAgentReady()},1E4)}}
function updateTimer(){--curTimerValue;0<=curTimerValue?(document.getElementById("timerValue").innerHTML=curTimerValue+" "+_localize("secs"),util.timers.push(window.setTimeout(function(){updateTimer()},1E3))):(document.getElementById("timerValue").style.display="none",displayDownloadArea())}
function displayDownloadArea(){document.getElementById("waitingmsg").style.display="none";document.getElementById("If_a_proxy_server_is_configured").style.display="none";document.getElementById("timerValue").style.display="none";document.getElementById("For_more_information_contact_your_help_desk_or_system_administrator").style.display="none";$(".connection_spinner").hide();$("#downloadArea").show()}
function hideDownloadArea(){document.getElementById("waitingmsg").style.display="";document.getElementById("If_a_proxy_server_is_configured").style.display="";document.getElementById("timerValue").style.display="";$(".connection_spinner").show();$("#downloadArea").hide()}
function show_waiting_spinner(){document.getElementById("waitingmsg").style.display="";document.getElementById("For_more_information_contact_your_help_desk_or_system_administrator").style.display="none";document.getElementById("If_a_proxy_server_is_configured").style.display="none";document.getElementById("timerValue").style.display="none";$("#downloadArea").hide();$(".connection_spinner").show()}
function probeAgent(){""!=ns_aaac&&(timerID&&window.clearTimeout(timerID),image=new Image,console.log("probing for times= "+probeErrors),image.onload=loginSuccess,image.onerror=probeError,image.src="http://localhost:"+agentPort+"/svc?NSC_AAAC="+ns_aaac+"&nsExtCookie="+ns_new_aaac+"&nsloc="+nsloc+"&nsversion=1,1,1,1&nstrace=DEBUG&nsvip=255.255.255.255",timerID=window.setTimeout(function(){probeTimeout()},3E3),util.timers.push(timerID))}
function probeError(){timerID&&(window.clearTimeout(timerID),console.log("Clearing timeout"),timerID=0);probeErrors++;nextAgentPort();console.log("Error no = "+probeErrors);util.timers.push(window.setTimeout(function(){probeAgent()},1E3))}function probeTimeout(){timerID&&window.clearTimeout(timerID);console.log("ProbeTimeout happened.");nextAgentPort();probeAgent()}function nsexit(){}
function checkIfInstalledAndDoLogin(){""!=ns_aaac&&(timerID&&window.clearTimeout(timerID),image=new Image,image.onload=loginSuccess,image.onerror=checkIfInstalledAndDoLoginFail,image.src="http://localhost:"+agentPort+"/svc?NSC_AAAC="+ns_aaac+"&nsloc="+nsloc+"&nsversion="+nsversion+"&nstrace=DEBUG&nsvip=255.255.255.255",timerID=window.setTimeout(function(){checkIfInstalledAndDoLoginTimeout()},3E3),util.timers.push(timerID))}
function checkIfInstalledAndDoLoginFail(){timerID&&window.clearTimeout(timerID);probeErrors++;10<probeErrors?displayDownloadArea():4==probeErrors&&(mac_iframe=document.createElement("iframe"),document.body.appendChild(mac_iframe),mac_iframe.setAttribute("width","1"),mac_iframe.setAttribute("height","1"),mac_iframe.hidden=!0,mac_iframe.src="com.citrix.nsgclient://");nextAgentPort();util.timers.push(window.setTimeout(function(){checkIfInstalledAndDoLogin()},1E3))}
function checkIfInstalledAndDoLoginTimeout(){nextAgentPort();checkIfInstalledAndDoLogin()}function onVPNDownload(){0<=navigator.userAgent.indexOf("Linux")?window.location.assign(downloadLinuxVPNPlugin()):-1!=navigator.userAgent.indexOf("Mac OS X")?window.location.assign("/vpns/scripts/mac/Citrix_Access_Gateway.dmg"):DonwloadlinkClick()}function onUbuntu18Download(){window.location.assign("/vpn/scripts/linux/nsgclient18_64.deb")}
function downloadLinuxVPNPlugin(){var a=navigator.platform;if(0<=a.indexOf("i686"))return"/vpn/scripts/linux/nsginstaller32.deb";if(0<=a.indexOf("x86_64"))return"/vpn/scripts/linux/nsginstaller64.deb"}
function AppendVPNDownloadContent(a){var b=$("<div></div>").attr({id:"downloadmsgBox","class":"field"}),d=$("<div></div>").attr({id:"downloadArea",style:"display:none","class":"credentialform"}),c=$("<p></p>").append($("<span></span>").attr({id:"If the Access Gateway Plug-in is not installed","class":"_ctxstxt_If_the_Access_Gateway_Plug-in_is_not_installed detail-text"}));b.append(c,"<br>");var c=$("<a></a>").attr({id:"plugin_download_button","class":"_ctxstxt_Download button default field"}),f=$("<a></a>").attr({id:"plugin_ubuntu_18_download_button",
"class":"_ctxstxt_DownloadUbuntu button default field ubuntu-downlad"});f.css("margin","5px 0px");var h=$("<p></p>").append($("<span></span>").attr({id:"Click_Download","class":"_ctxstxt_Click_Download detail-text"}));$(c).click(function(a){a.preventDefault();onVPNDownload()});$(f).click(function(a){a.preventDefault();onUbuntu18Download()});if(0<=navigator.userAgent.indexOf("Linux")){var e=$("<span></span>").attr({id:"To install the Netscaler Access Gateway Client for Linux","class":"_ctxstxt_To_install_the_Netscaler_Access_Gateway_Client_for_Linux detail-text"}),
g=$("<p></p>").append($("<span></span>").attr({id:"Linux install using software center","class":"_ctxstxt_Linux_install_using_software_center detail-text"}));b.append(e,h,g)}else if(-1!=navigator.userAgent.indexOf("Mac OS X"))h=$("<div></div>").attr({id:"If the Access Gateway Plug-in is not installed","class":"_ctxstxt_To_install_the_Netscaler_Access_Gateway_Client_for_Mac detail-text"}),b.append(h);else{var e=$("<p></p>").append($("<span></span>").attr({id:"To_install_the_Access_Gateway_Plugin",
"class":"_ctxstxt_To_install_the_Access_Gateway_Plugin detail-text"})),g=$("<p></p>").append($("<span></span>").attr({id:"In_the_File_Download_dialog_box_click_Run","class":"_ctxstxt_In_the_File_Download_dialog_box_click_Run detail-text"})),k=$("<p></p>").append($("<span></span>").attr({id:"In_the_Internet_Explorer_dialog_box_click_Run_to_install_the_Access_Gateway_Plugin_for_Windows","class":"_ctxstxt_In_the_Internet_Explorer_dialog_box_click_Run_to_install_the_Access_Gateway_Plugin_for_Windows detail-text"}));
b.append(e,h,g,k)}d.append(b,c);0<=navigator.userAgent.indexOf("Linux")&&0<=navigator.platform.indexOf("x86_64")&&d.append(f);d.ctxsLocalize();a.append(d)}function ns_getcookie(a){var b,d,c=document.cookie;return 0<c.length&&(b=c.indexOf(a),-1!=b)?(b+=a.length+1,d=c.indexOf(";",b),-1==d&&(d=c.length),supports65BytesCookie||"NSC_EPAC"!=a&&"NSC_AAAC"!=a||(d=Math.min(d,b+NS_OLD_COOKIE_LEN)),decodeURIComponent(c.substring(b,d))):null}
function pluginSuccess(){util.clearAllTimeouts();success_callback_fullvpn("Establishing_fullvpn_Windows");console.log("Plugin connected. Auto post done. Apps should load.");show_waiting_spinner()}
function loginSuccess(a){UnsetCookie("START_PROBE_AGENT");UnsetCookie("BROWSER_CONNECT");UnsetCookie("NSC_EPAFALLBACK");UnsetCookie("NGLAUNCH_MISSING");2==this.height?(console.log("Plugin returned failure"),UnsetCookie("NSC_AAAC"),UnsetCookie("NSC_USER"),UnsetCookie("NSC_EPAC"),UnsetCookie("NSC_VPNERR"),window.location="/"):(timerID&&window.clearTimeout(timerID),"http:"==location.protocol&&(document.cookie="NSC_HTTPVSERVER=1; path=/"),console.log("Plugin connected. Requesting callback to proceed."),
plugin_connected||(window.clearTimeout(timerID),util.clearAllTimeouts(),pluginSuccess(),plugin_connected=!0))}function nextAgentPort(){agentPort+=1;3150<agentPort&&(agentPort=3148)}function showWinVPNTimerDisplay(a){a?(document.getElementById("downloadArea").style.display="none",document.getElementById("timerValue").style.display=""):(document.getElementById("downloadArea").style.display="",document.getElementById("timerValue").style.display="none")}
function noWinVPNLauncher(){if(!util.isPluginActive){var a=new Date;a.setTime(a.getTime()+18E4);document.cookie="NGLAUNCH_MISSING=1;expires="+a.toGMTString()+"; path=/";util.clearAllTimeouts();!secureToken||util.useOnlyLocalHostComm||util.win.NOPSuccess?detectAgent():util.win.pluginLaunch()}}
function showWinVPNTimer(){if(0==curTimerValue)noWinVPNLauncher();else{if(!document.getElementById("timerValue")){var a=document.getElementById("downloadArea"),b=document.createElement("span");b.setAttribute("id","AppINFO");a.parentNode.appendChild(b);b.innerHTML="<br />";b.innerHTML+=_localize("AppINFO")?_localize("AppINFO"):"Checking if the plug-in is installed";b.innerHTML+="<br />";b=document.createElement("span");b.setAttribute("id","timer");a.parentNode.appendChild(b)}showWinVPNTimerDisplay(!0);
document.getElementById("timerValue").innerHTML=curTimerValue+" "+_localize("secs");--curTimerValue;showTimerHandler=window.setTimeout(function(){showWinVPNTimer()},1E3);util.timers.push(showTimerHandler)}}function launcherExited(){document.cookie="START_PROBE_AGENT=1; path=/";util.clearAllTimeouts();detectAgent()}
function launcherPresent(){util.win.NOPSuccess=!0;util.prob("isAgentReady",function(){2==this.height?util.prob("exit",launcherExited,launcherExited):(document.cookie="AGENT_NOT_INSTALLED=1; path=/",util.clearAllTimeouts(),detectAgent())},noWinVPNLauncher)}
function checkIfAgentReadyChrome(){timerID&&(window.clearTimeout(timerID),timerID=0);1==ns_getcookie("NGLAUNCH_MISSING")?(detectPluginVersion(),checkIfAgentReadyViaPlugin()):1==ns_getcookie("AGENT_NOT_INSTALLED")?(displayDownloadArea(),UnsetCookie("AGENT_NOT_INSTALLED"),timerID=window.setTimeout(function(){checkIfAgentReadyChrome()},12E3),util.timers.push(timerID)):1==ns_getcookie("START_PROBE_AGENT")?probeAgent():secureToken&&!util.useOnlyLocalHostComm?(util._launchSuccessHandler=launcherPresent,
util._checkIfLaunched()):(util.launchPlugin(launcherPresent,function(){}),showWinVPNTimer())}function pluginWontUpgrade(a){if(0>util.compareVersion(a,"11,0,0,0"))return 0!=util.compareVersion(a,nsVersion);var b=util.getPluginInfo("WIN","VPN");return"Never"==b.upgradeType?!0:"Essential"==b.upgradeType?b.compatibleTill&&""!==b.compatibleTill&&0<util.compareVersion(a,b.compatibleTill)?!1:0<=util.compareVersion(a,b.compatibleFrom):0==util.compareVersion(b.version,a)}
function checkIfWinAgentReady(){timerID&&(window.clearTimeout(timerID),timerID=0);try{if(1==ns_getcookie("AGENT_NOT_INSTALLED"))displayDownloadArea(),UnsetCookie("AGENT_NOT_INSTALLED"),secureToken&&!util.useOnlyLocalHostComm?(window.clearTimeout(showTimerHandler),timerID=window.setTimeout(function(){checkIfWinAgentReady()},16E3)):timerID=window.setTimeout(function(){checkIfWinAgentReady()},12E3),util.timers.push(timerID);else if(1==ns_getcookie("START_PROBE_AGENT"))probeAgent();else{var a=new ActiveXObject("nsepacom.nsepaclass"),
b=a.isAgentReady();if(1==b)if("getPluginVersion"in a&&pluginWontUpgrade(a.getPluginVersion())&&1!=ns_getcookie("BROWSER_CONNECT")){document.cookie="BROWSER_CONNECT=1; path=/";b=a.browserConnect("GET /svc?NSC_AAAC="+ns_aaac+"&nsExtCookie="+ns_new_aaac+"&nsloc="+nsloc+"&nsversion="+nsVersion+"&nstrace=DEBUG&nsvip=255.255.255.255&nstdi=ON HTTP/1.1\r\n");if(1==b){loginSuccess();return}UnsetCookie("BROWSER_CONNECT");document.cookie="START_PROBE_AGENT=1; path=/";util.clearAllTimeouts();detectAgent()}else document.cookie=
"START_PROBE_AGENT=1; path=/";else document.cookie="AGENT_NOT_INSTALLED=1; path=/";detectAgent()}}catch(d){a?detectAgent():(displayDownloadArea(),timerID=window.setTimeout(function(){checkIfWinAgentReady()},3E3),util.timers.push(timerID))}}function detectPluginVersion(){(-1<navigator.userAgent.indexOf("Gecko/2")||-1<navigator.userAgent.indexOf("AppleWebKit"))&&"Win64"==navigator.platform&&(require64bitPlugin=!0)}
function checkIfAgentReadyViaPlugin(){timerID&&(window.clearTimeout(timerID),timerID=0);try{if(1==ns_getcookie("AGENT_NOT_INSTALLED"))displayDownloadArea(),UnsetCookie("AGENT_NOT_INSTALLED"),timerID=window.setTimeout(function(){checkIfAgentReadyViaPlugin()},12E3),util.timers.push(timerID);else if(1==ns_getcookie("START_PROBE_AGENT"))probeAgent();else{navigator.plugins.refresh(!1);var a;if(require64bitPlugin?navigator.mimeTypes["application/citrix-npagee64"]:navigator.mimeTypes["application/citrix-npagee"]){document.getElementById("plugindiv").innerHTML=
require64bitPlugin?'<object id="npageeobject" type="application/citrix-npagee64" height="1" width="1"></OBJECT>':'<object id="npageeobject" type="application/citrix-npagee" height="1" width="1"></OBJECT>';a=document.getElementById("npageeobject");var b=a.isAgentReady();if("1"==b){if((getPluginVersion="getPluginVersion"in a)&&pluginWontUpgrade(a.getPluginVersion())&&1!=ns_getcookie("BROWSER_CONNECT")){document.cookie="BROWSER_CONNECT=1; path=/";b=a.browserConnect("GET /svc?NSC_AAAC="+ns_aaac+"&nsExtCookie="+
ns_new_aaac+"&nsloc="+nsloc+"&nsversion="+nsVersion+"&nstrace=DEBUG&nsvip=255.255.255.255&nstdi=ON HTTP/1.1\r\n");1==b?(loginSuccess(),console.log("Browser connect happened")):(UnsetCookie("BROWSER_CONNECT"),document.cookie="START_PROBE_AGENT=1; path=/",console.log("Browser connect didnt happened"),detectAgent());return}document.cookie="START_PROBE_AGENT=1; path=/"}else document.cookie="AGENT_NOT_INSTALLED=1; path=/";detectAgent()}else displayDownloadArea(),probeAgent()}}catch(d){displayDownloadArea(),
probeAgent()}}function detectAgent(){isInsideVPN()?triggerVPN():(util.fallbackStarted=!0,clearInterval(util.pollNSId),secureToken&&""==ns_aaac?util.getNoHttpOnlyCookies(function(){checkForCookies();handleAgent()}):handleAgent())}
function handleAgent(){util.checkIfLaunched=util._checkIfLaunched;checkForCookies();util.win.ACTIVEX_SUPPORTED?util.timers.push(window.setTimeout(function(){checkIfWinAgentReady()},1E3)):util.useLauncher?checkIfAgentReadyChrome():-1<navigator.userAgent.indexOf("Firefox")||-1<navigator.userAgent.indexOf("Gecko/2")||-1<navigator.userAgent.indexOf("AppleWebKit")?(util.timers.push(window.setTimeout(function(){detectPluginVersion()},1E3)),checkIfAgentReadyViaPlugin()):(displayDownloadArea(),probeAgent())}
function DonwloadlinkClick(){util.redirectToPlugin("WIN","VPN")}function checkIfInstalledAndDoLogin_linux(){""!=ns_aaac&&(timerID&&window.clearTimeout(timerID),image=new Image,image.onload=loginSuccess,image.onerror=probeError_linux,image.src="http://localhost:"+agentPort+"/svc?NSC_AAAC="+ns_aaac+"&nsloc="+nsloc+"&nsversion=11,0,49,205&nstrace=DEBUG&nsvip=255.255.255.255",timerID=window.setTimeout(function(){probeTimeout()},3E3),util.timers.push(timerID))}
function probeAgent_linux(){""!=ns_aaac&&(timerID&&window.clearTimeout(timerID),image=new Image,image.onload=loginSuccess,image.onerror=probeError_linux,image.src="http://localhost:"+agentPort+"/svc?NSC_AAAC="+ns_aaac+"&nsloc="+nsloc+"&nsversion=1,1,1,1&nstrace=DEBUG&nsvip=255.255.255.255",timerID=window.setTimeout(function(){probeTimeout()},3E3),util.timers.push(timerID))}
function linux_launchVpnApp(a){var b="application://NSGClient";a&&!util.useOnlyLocalHostComm&&(b=b+"/"+document.location.host,b+="/",b+=a,b+="/");-1!=navigator.userAgent.search("Firefox")?((a=document.getElementById("launcherIframe"))&&a.parentNode.removeChild(a),a=document.createElement("iframe"),a.setAttribute("src",b),a.id="launcherIframe",a.style.width="1px",a.style.height="1px",a.style.visibility="hidden",document.body.appendChild(a)):window.location=b}
function probeError_linux(){timerID&&window.clearTimeout(timerID);probeErrors++;0!=probeErrors%30&&1!=probeErrors||linux_launchVpnApp();20<probeErrors&&displayDownloadArea();nextAgentPort();util.timers.push(window.setTimeout(function(){probeAgent_linux()},1E3))}function oldprobeError(){timerID&&window.clearTimeout(timerID);probeErrors++;20<probeErrors&&displayDownloadArea();nextAgentPort();util.timers.push(window.setTimeout(function(){probeAgent_linux()},500))}
function checkIfAgentReady_linux(){util.timers.push(window.setTimeout(function(){checkIfInstalledAndDoLogin_linux()},2500))}function _registerEvent(a,b,d){if(a.addEventListener)return a.addEventListener(b,d),{remove:function(){a.removeEventListener(b,d)}};a.attachEvent(b,d);return{remove:function(){a.detachEvent(b,d)}}}function _createHiddenIframe(a,b){var d=document.createElement("iframe");d.src=b;d.id="hiddenIframe";d.style.display="none";a.appendChild(d);return d}
function openGatewayUriWithHiddenFrame(a,b,d){var c=setTimeout(function(){b();h.remove()},3E3),f=document.querySelector("#hiddenIframe");f||(f=_createHiddenIframe(document.body,"about:blank"));var h=_registerEvent(window,"blur",function(){clearTimeout(c);h.remove();d()});f.contentWindow.location.href=a}
function openUriWithTimeoutHack(a,b,d){for(var c=setTimeout(function(){b();h.remove()},1E3),f=window;f!=f.parent;)f=f.parent;var h=_registerEvent(f,"blur",function(){clearTimeout(c);h.remove();d()});window.location=a}function openUriUsingFirefox(a,b,d){var c=document.querySelector("#hiddenIframe");c||(c=_createHiddenIframe(document.body,"about:blank"));try{c.contentWindow.location.href=a,d()}catch(f){"NS_ERROR_UNKNOWN_PROTOCOL"==f.name&&b()}}
function openUriUsingIEInOlderWindows(a,b,d){10===getInternetExplorerVersion()?openUriUsingIE10InWindows7(a,b,d):9===getInternetExplorerVersion()||11===getInternetExplorerVersion()?openGatewayUriWithHiddenFrame(a,b,d):openUriInNewWindowHack(a,b,d)}
function openUriUsingIE10InWindows7(a,b,d){var c=setTimeout(b,1E3);window.addEventListener("blur",function(){clearTimeout(c);d()});var f=document.querySelector("#hiddenIframe");f||(f=_createHiddenIframe(document.body,"about:blank"));try{f.contentWindow.location.href=a}catch(h){b(),clearTimeout(c)}}
function openUriInNewWindowHack(a,b,d){var c=window.open("","","width=0,height=0");c.document.write("<iframe src='"+a+"'></iframe>");setTimeout(function(){try{c.setTimeout("window.close()",1E3),d()}catch(a){c.close(),b()}},1E3)}function openUriWithMsLaunchUri(a,b,d){try{navigator.msLaunchUri(a,d,b)}catch(c){b()}}
function checkBrowser(){var a=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/");return{isOpera:a,isFirefox:"undefined"!==typeof InstallTrigger,isSafari:0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),isChrome:!!window.chrome&&!a,isIE:!!document.documentMode}}
function getInternetExplorerVersion(){var a=-1;if("Microsoft Internet Explorer"===navigator.appName){var b=navigator.userAgent,d=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=d.exec(b)&&(a=parseFloat(RegExp.$1))}else"Netscape"===navigator.appName&&(b=navigator.userAgent,d=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!=d.exec(b)&&(a=parseFloat(RegExp.$1)));return a}
window.protocolCheck=function(a,b,d){function c(){b&&b()}function f(){d&&d()}if(navigator.msLaunchUri)console.log("IE or Edge browser in win8 or WIn10"),openUriWithMsLaunchUri(a,c,f);else{var h=checkBrowser();h.isFirefox?openUriUsingFirefox(a,c,f):h.isChrome?openGatewayUriWithHiddenFrame(a,c,f):h.isIE?openUriUsingIEInOlderWindows(a,c,f):openGatewayUriWithHiddenFrame(a,c,f)}};var SYM_ENC_ALGO="AES-GCM",SYN_ENC_KEY_LEN=256,EC_CURVE_NAME="P-256";
function getECDetails(a,b){var d=b?b:function(){};window.pass_enc_enable=!1;window.pass_enc_server_timestamp=null;$.ctxsAjax({store:null,async:!0,type:"GET",url:"/nf/auth/getECdetails",success:function(b,f,h){b=JSON.parse(b);"ENABLED"==b.encrypt&&(window.pass_enc_enable=!0,window.pass_enc_server_timestamp=b.timestamp,b=b.ecpubkey,a?d():beginKeyProcessing(b))},error:function(a,b,d){},ajax:!1})}$(getECDetails());
function encryptionErrHandler(a){CTXS.ExtensionAPI.showMessage({localize:!0,messageText:"pass_enc_encryption_failed_message",messageTitle:"pass_enc_encryption_failed_header",okButtonText:"OK",isalert:!1})}function hexToArrayBuffer(a){for(var b=a.length/2,d=new ArrayBuffer(b),c=new Uint8Array(d),f=0;f<b;f++)c[f]=16*parseInt(a[2*f],16),c[f]+=parseInt(a[2*f+1],16);return d}
function stringToArrayBuffer(a){for(var b=a.length,d=new ArrayBuffer(b),c=new Uint8Array(d),f=0;f<b;f++)c[f]=a.charCodeAt(f);return d}function arrayBufferToString(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function appendBuffers(a,b){var d=new Uint8Array(a.byteLength+b.byteLength);d.set(new Uint8Array(a),0);d.set(new Uint8Array(b),a.byteLength);return d.buffer}
function beginKeyProcessing(a){window.pass_enc_client_key="";window.pass_enc_crypto_obj=null;window.pass_enc_is_ms_crypto=!1;window.pass_enc_iv=null;window.crypto&&window.crypto.subtle?(window.pass_enc_crypto_obj=window.crypto.subtle,CTXS.Device.isSpartan()?handleEncryptionWithElliptic(a):handleEncryptionNative(a)):window.msCrypto&&window.msCrypto.subtle?(window.pass_enc_is_ms_crypto=!0,window.pass_enc_crypto_obj=window.msCrypto.subtle,handleEncryptionWithElliptic(a)):CTXS.ExtensionAPI.showMessage({localize:!0,
messageText:"pass_enc_unsupported_browser_message",messageTitle:"pass_enc_unsupported_browser_header",okButtonText:"OK",isalert:!0})}function promiseWrapper(a,b,d,c){c="undefined"!==typeof c?c:encryptionErrHandler;window.pass_enc_is_ms_crypto?(a=a.apply(pass_enc_crypto_obj,b),a.oncomplete=function(a){d(a.target.result)},a.onerror=c):a.apply(pass_enc_crypto_obj,b).then(d)["catch"](c)}
function encryptData(a,b,d,c){promiseWrapper(pass_enc_crypto_obj.encrypt,[{name:SYM_ENC_ALGO,iv:b,tagLength:128},a,d],function(a){window.msCrypto?c(btoa(arrayBufferToString(a.ciphertext))):c(btoa(arrayBufferToString(a)))})}function getHashedKey(a){promiseWrapper(pass_enc_crypto_obj.deriveBits,[{name:"HKDF",hash:"SHA-256",salt:new Uint8Array,info:new Uint8Array},a,352],saveSessionKey)}
function saveSessionKey(a){window.pass_enc_iv=a.slice(0,12);promiseWrapper(pass_enc_crypto_obj.importKey,["raw",a.slice(12,44),{name:SYM_ENC_ALGO,length:SYN_ENC_KEY_LEN},!1,["encrypt"]],function(b){window.pass_enc_session_key=b;isInsideVPN()&&(window.pass_enc_session_keydata=a.slice(12,44))},encryptionErrHandler)}
function deriveKey(a,b){pass_enc_crypto_obj.deriveBits({name:"ECDH","public":a},b,256).then(function(a){promiseWrapper(pass_enc_crypto_obj.importKey,["raw",a,{name:"HKDF"},!1,["deriveBits"]],getHashedKey)})["catch"](encryptionErrHandler)}
function getClientKey(a){pass_enc_crypto_obj.generateKey({name:"ECDH",namedCurve:EC_CURVE_NAME},!0,["deriveBits"]).then(function(b){crypto.subtle.exportKey("raw",b.publicKey).then(function(d){window.pass_enc_client_key=btoa(arrayBufferToString(d));deriveKey(a,b.privateKey)})["catch"](encryptionErrHandler)})["catch"](encryptionErrHandler)}
function handleEncryptionNative(a){pass_enc_crypto_obj.importKey("raw",stringToArrayBuffer(atob(a)),{name:"ECDH",namedCurve:EC_CURVE_NAME},!0,[]).then(function(a){getClientKey(a)})["catch"](encryptionErrHandler)}function calcHmac(a,b,d){promiseWrapper(window.pass_enc_crypto_obj.importKey,["raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]],function(a){promiseWrapper(window.pass_enc_crypto_obj.sign,[{name:"HMAC",hash:{name:"SHA-256"}},a,b],d)})}
function deriveHkdf(a,b,d,c){a||(a=new Uint8Array(32));calcHmac(a,b,function(a){function b(k){g.push(k);if(g.length<=e)k=appendBuffers(k,hexToArrayBuffer("0"+g.length)),calcHmac(a,k,b);else{k=g[0];for(var l=1;l<g.length;l++)k=appendBuffers(k,g[l]);c(k.slice(0,Math.ceil(d/8)))}}var e=Math.ceil(d/256),g=[];g.push(stringToArrayBuffer(""));calcHmac(a,hexToArrayBuffer("01"),b)})}
function handleEncryptionWithElliptic(a){var b=EC_CURVE_NAME.toLowerCase().replace("-",""),b=new elliptic.ec(b);a=b.keyFromPublic(atob(a));b=b.genKeyPair();window.pass_enc_client_key=btoa(arrayBufferToString(b.getPublic().encode()));a=b.derive(a.getPublic()).toString(16);deriveHkdf(null,hexToArrayBuffer(a),352,saveSessionKey)}function checkForCookiesAndLaunch(a){setTimeout(function(){checkForCookies();a()},1E3)}
localhostPluginLaunch=function(){util.fallbackStarted=!0;var a;util._launchErrorHandler=util.emptyFunction;-1!=navigator.platform.indexOf("Mac")?a=checkIfAgentReady:-1!=navigator.platform.indexOf("Win")?(util.checkIfLaunched=util._checkIfLaunched,a=detectAgent):-1!=navigator.platform.indexOf("Linux")&&(a=checkIfAgentReady_linux);""==ns_aaac?secureToken?util.getNoHttpOnlyCookies(checkForCookiesAndLaunch(a)):isInsideVPN()?a():(console.error("cookie and token both are missing. Cannot launch plugin"),
window.location="/"):a()};
checkForCookies=function(){var a=document.cookie;0<a.length&&(begin=a.indexOf(aaacCookie+"="),-1!=begin&&(begin+=aaacCookie.length+1,end=a.indexOf(";",begin),-1==end&&(end=a.length),ns_new_aaac=ns_aaac=decodeURIComponent(a.substring(begin,end)),ns_aaac=ns_aaac.substring(0,NS_OLD_COOKIE_LEN)),begin=a.indexOf(postEPACookie+"="),-1!=begin&&(begin+=postEPACookie.length+1,end=a.indexOf(";",begin),-1==end&&(end=a.length),(ns_postepa=decodeURIComponent(a.substring(begin,end)))&&(nsloc+="/postepa.html")))};
